name: Generate HTML Report and Send Email

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Run PowerShell script to generate HTML report
        run: pwsh ./generate-report.ps1

      - name: List files in workspace (Debug)
        run: dir

      - name: Upload HTML report as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: daily-report
          path: report.html

  send_mail:
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: daily-report

      - name: Show downloaded files (Debug)
        run: ls -la

      - name: Send email with SendGrid
        uses: peter-evans/sendgrid-action@v1
        with:
          sendgrid-api-key: ${{ secrets.SENDGRID_API_KEY }}
          from: Ashjan.aljbreen@gmail.com
          to: ashjannnnnnn@gmail.com
          subject: "âœ… Daily HTML Report Ready!"
          body: |
            Hi Team! ðŸ‘‹

            The daily HTML report is ready.
            Check the attached report or artifact.

            ðŸš€ Regards,
            DevOps Bot

          attachments: report.html
