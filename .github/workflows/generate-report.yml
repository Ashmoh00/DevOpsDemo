name: Generate HTML Report and Send Email

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Run PowerShell script to generate HTML report
        run: pwsh ./generate-report.ps1

      - name: List files in workspace (Debug)
        run: dir

      - name: Upload HTML report as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: daily-report
          path: report.html

  send_mail:
    needs: build
    runs-on: ubuntu-latest

    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: daily-report

      - name: Show downloaded files (Debug)
        run: ls -la

      - name: Send Email with report
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "‚úÖ Daily HTML Report"
          to: your-receiver@example.com
          from: ${{ secrets.EMAIL_USERNAME }}
          content_type: text/html
          attachments: report.html
          body: |
            Hello üëã,<br/>
            Please find the attached daily HTML report.<br/><br/>
            ‚úîÔ∏è Generated automatically by GitHub Actions.<br/>
            üîó Have a nice day!
