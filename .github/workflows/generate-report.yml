name: Generate HTML Report and Send Email

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Run PowerShell script to generate HTML report
        run: pwsh ./generate-report.ps1

      - name: Upload HTML report as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: daily-report
          path: report.html

  send_mail:
    needs: build  # Ù‡Ø°Ø§ Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ Ù„ØªØ´ØºÙŠÙ„ Job Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ù€ build
    runs-on: ubuntu-latest

    steps:
      - name: Download Artifact
        uses: actions/download-artifact@v4
        with:
          name: daily-report

      - name: Show downloaded files (Debug)
        run: ls -la

      - name: Debug message
        run: echo "âœ… send_mail job is running!"

      - name: Send email with SendGrid
        uses: peter-evans/sendgrid-action@v1
        with:
          sendgrid-api-key: ${{ secrets.SENDGRID_API_KEY }}
          from: ashjannnnnnn@gmail.com
          to: Ashjan.aljbreen@gmail.com
          subject: "âœ… Daily HTML Report Ready!"
          body: |
            Hi Team! ðŸ‘‹

            The daily HTML report is ready.
            Check the attached report.

            ðŸš€ Regards,
            DevOps Bot

          attachments: report.html
